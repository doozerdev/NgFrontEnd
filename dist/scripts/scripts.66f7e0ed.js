"use strict";angular.module("webClientApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ngFacebook","ui.sortable"]).config(["$routeProvider","$facebookProvider","$httpProvider",function(a,b,c){b.setAppId(0x5d13193fb27c0),a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",resolve:{store:["doozerList",function(a){return a}]}}).when("/search",{templateUrl:"views/search.html",controller:"SearchCtrl"}).when("/search/:searchTerm",{templateUrl:"views/search.html",controller:"SearchCtrl"}).when("/solution",{templateUrl:"views/solutions.html",controller:"SolutionsCtrl"}).when("/alltasks",{templateUrl:"views/alltasks.html",controller:"SolutionsCtrl"}).when("/solution/:id",{templateUrl:"views/solution.html",controller:"SolutionCtrl"}).when("/users",{templateUrl:"views/users.html",controller:"UsersCtrl"}).when("/user/:id",{templateUrl:"views/user.html",controller:"UserCtrl"}).when("/createtip",{templateUrl:"views/newsolution.html",controller:["$scope","$rootScope",function(a){a.result=[]}]}).when("/:id",{templateUrl:"views/list.html",controller:"ListCtrl"}).when("/:id/item",{templateUrl:"views/item.html",controller:"ItemCtrl"}).when("/:id/itemexpert",{templateUrl:"views/itemexpert.html",controller:"ItemExpertCtrl"}).when("/:id/itemadmin",{templateUrl:"views/itemadmin.html",controller:"ItemExpertCtrl"}).otherwise({redirectTo:"/"}),c.interceptors.push(["$rootScope","$q",function(a,b){return{responseError:function(c){if(401==c.status){var d=b.defer();return a.httpRetryBuffer.push({config:c.config,deferred:d}),a.$broadcast("dzr-loginRequired"),d.promise}return b.reject(c)}}}])}]).constant("doozerURL","http://api.test.doozer.tips/api/").run(["$rootScope","$location",function(a,b){a.httpRetryBuffer=[],a.location=b,function(a,b,c){var d,e=a.getElementsByTagName(b)[0];a.getElementById(c)||(d=a.createElement(b),d.id=c,d.src="//connect.facebook.net/en_US/sdk.js",e.parentNode.insertBefore(d,e))}(document,"script","facebook-jssdk")}]),angular.module("webClientApp").controller("MainCtrl",["$scope","$cookies","Item","Solution",function(a,b,c){c.server.lists(function(c){a.lists=c.items,a.username=b.get("username")},function(a){401==a.status&&console.log("got a 401 on loading page data - should have already been caught by http interceptor!!")}),a.addList=function(){var b={title:a.newList.trim(),archive:!1};if(b.title){var d=new c.server;d.title=b.title,d.archive=b.archive,c.server.save(d,function(b){a.lists.push(b),a.newList=""})}},a.removeList=function(b){c.server.archive({item_id:b.id},function(){a.lists.splice(a.lists.indexOf(b),1)})},a.editItem=function(b){a.editedItem=b,a.originalItem=angular.extend({},b)},a.saveEdits=function(b){c.server.get({item_id:b.id},function(c){c.title=b.title,c.$update({item_id:b.id}),a.editedItem=null})}}]),angular.module("webClientApp").controller("SearchCtrl",["$scope","$routeParams","$facebook","$location","Search",function(a,b,c,d,e){a.search=function(){e.query({searchTerm:a.searchTerm.trim()},function(b){a.results=b.items,a.request_time=b.request_time,d.path("search/"+a.searchTerm)})},c.api("/me").then(function(b){a.userId=b.id}),b.searchTerm&&(a.searchTerm=b.searchTerm,a.search())}]),angular.module("webClientApp").controller("SolutionCtrl",["$scope","$routeParams","Solution","Search","Item",function(a,b,c,d,e){c.server.get({id:b.id},function(b){a.solution=b,a.solution.expire_date=new Date(a.solution.expire_date),c.server.performance({id:b.id},function(b){a.solution.performance=b})}),c.server.items({id:b.id},function(b){b.items?(a.items=b.items,angular.forEach(a.items,function(b){a.getParent(b),a.getState(b)})):a.items=[]}),a.getParent=function(a){e.server.get({item_id:a.parent},function(b){a.parentTitle=b.title})},a.getState=function(a){c.server.state({id:b.id,item_id:a.id},function(b){a.solution_state=b,a.solution_state.current=a.solution_state.like>0?"Liked":a.solution_state.like<0?"Disliked":a.solution_state.views>0?"Viewed":"Unseen"},function(b){404==b.status&&(a.solution_state={},a.solution_state.current="Unseen",a.solution_state.like=0,a.solution_state.clicks=0,a.solution_state.views=0)})},a.toggleMap=function(d){var e=a.checkLink(d);-1===e?c.server.mapItem({id:b.id,item_id:d.id},function(){a.items.unshift(d)}):c.server.unmapItem({id:b.id,item_id:d.id},function(){a.items.splice(e,1)})},a.checkLink=function(b){if(null===b)return-1;if(a.items.length<1)return-1;for(var c=0;c<a.items.length;c++)if(a.items[c].id===b.id)return c;return-1},a.search=function(){return""==a.searchTerm.trim()?(a.results=void 0,void(a.request_time="")):void d.query({searchTerm:a.searchTerm.trim()},function(b){a.results=b.items,a.request_time=b.request_time;for(var c=a.results.length-1;c>=0;c--)if(a.results[c].parent)a.getParent(a.results[c]);else{var d=a.results.splice(c,1);console.log("skipped list: "),console.log(d)}})}}]),angular.module("webClientApp").controller("SolutionsCtrl",["$scope","$location","Solution","Search","Item","User",function(a,b,c,d,e,f){a.solutions=[],a.users=[],a.active_items=[],a.active_beta_items=[],a.all_items=[],a.show_beta=!0,"/alltasks"!=b.path()&&(c.server.query(function(b){a.solutions=b,angular.forEach(a.solutions,function(a){c.server.performance({id:a.id},function(b){a.performance=b})})}),f.server.query(function(b){var c=b;console.log("total users including test accounts: "+c.length),f.getTestIds().then(function(b){var d=[];d=d.concat(b);var f=null;angular.forEach(c,function(b){d.length>0?(f=a.sortHelper(b.uid,d),-1==f?(a.users.push(b),e.server.listsForUser({userId:b.uid},function(c){a.getItemsFromLists(c.items,b,!0,!0,!1)})):(d.splice(f,1),console.log("skipping test user"))):(a.users.push(b),e.server.listsForUser({userId:b.uid},function(c){a.getItemsFromLists(c.items,b,!0,!0,!1)}))})})})),"/alltasks"==b.path()&&f.server.query(function(b){a.users=b,console.log(a.users.length),angular.forEach(a.users,function(b){f.checkTestUser(b.uid)?console.log("skipping test user"):e.server.listsForUser({userId:b.uid},function(c){a.getItemsFromLists(c.items,b,!1,!1,!0)})})}),a.sortHelper=function(a,b){for(var c=0;c<b.length;c++)if(a==b[c])return c;return-1},a.getItemsFromLists=function(b,c,d,f,g){var h=[];angular.forEach(b,function(b){e.server.childrenForUser({item_id:b.id,userId:c.uid},function(c){f?(h=e.getActiveItems(c.items),console.log("finished getting active items from another list"),g&&angular.forEach(h,function(a){a.parentTitle=b.title}),a.active_items=a.active_items.concat(h),d&&(a.active_beta_items=a.active_beta_items.concat(h))):(h=c.items,g&&angular.forEach(h,function(a){a.parentTitle=b.title}),a.all_items=a.all_items.concat(h),console.log("finished getting ALL items from another list"))})})},a.removeSolution=function(b){c.server["delete"]({id:b.id},function(){a.solutions.splice(a.solutions.indexOf(b),1)})},a.getItemParent=function(a){e.server.get({item_id:a.parent},function(b){a.parentTitle=b.title})},a.search=function(){return""==a.searchTerm.trim()?(a.item_results=void 0,a.item_request_time="",void(a.solution_results=void 0)):void d.query({searchTerm:a.searchTerm.trim()},function(b){a.item_results=b.items,a.item_request_time=b.request_time,a.solution_results=!0;for(var c=a.item_results.length-1;c>=0;c--)if(a.item_results[c].parent)a.getItemParent(a.item_results[c]);else{var d=a.item_results.splice(c,1);console.log("skipped list: "),console.log(d)}})}}]),angular.module("webClientApp").controller("SolutionInterCtrl",["$scope","$routeParams","Solution",function(a,b,c){a.likeSolution=function(a){c.server.like({id:a.id,item_id:b.id},function(){alert("liked")})},a.dislikeSolution=function(a){c.server.dislike({id:a.id,item_id:b.id},function(){alert("disliked")})}}]),angular.module("webClientApp").controller("UsersCtrl",["$scope","$routeParams","User",function(a,b,c){a.betaUsers=[],a.testUsers=[],c.server.query(function(b){a.betaUsers=b,console.log("total number of users returned from server: "+a.betaUsers.length),c.getTestIds().then(function(b){var c=[];c=c.concat(b);for(var d=0,e=null;c.length>0&&d<a.betaUsers.length;)e=a.sortHelper(a.betaUsers[d].uid,c),-1==e?d++:(a.testUsers.push(a.betaUsers[d]),a.betaUsers.splice(d,1),c.splice(e,1));0!=c.length&&(console.log("couldn't find these test users:"),console.log(c))})}),a.sortHelper=function(a,b){for(var c=0;c<b.length;c++)if(a==b[c])return c;return-1}}]),angular.module("webClientApp").controller("UserCtrl",["$scope","$routeParams","User","Item","Solution",function(a,b,c,d,e){a.items=[],a.solutions=[],a.lists=[],a.user={},c.server.get({userId:b.id},function(b){a.user=b}),d.server.listsForUser({userId:b.id},function(c){a.lists=c.items;var e=[];angular.forEach(a.lists,function(c){d.server.childrenForUser({item_id:c.id,userId:b.id},function(b){e=d.getActiveItems(b.items),console.log("finished getting active items from another list"),angular.forEach(e,function(b){b.parentTitle=c.title,b.solutions_count>0&&a.getSolutionsForItem(b)}),a.items=a.items.concat(e)})})}),a.getSolutionsForItem=function(b){d.server.solutions({item_id:b.id},function(c){var d=c.items;angular.forEach(d,function(c){e.setupState(c.id,b.id).then(function(b){c.item_state=b,a.solutions=a.solutions.concat(c)})})})}}]),angular.module("webClientApp").controller("ListCtrl",["$scope","$routeParams","Item",function(a,b,c){var d=33554432,e=2147483647;a.editedItem=null,a.isDoneGroupOpen=!1,a.hasDoneHeader=!1,c.server.children({item_id:b.id},function(d){a.items=d.items,a.list=c.server.get({item_id:b.id});var e=-1;angular.forEach(a.items,function(b){b.order&&b.order>e&&(e=b.order),b.duedate=new Date(b.duedate),"completed_header"==b.type&&(console.log("completed header found:"),console.log(b),a.hasDoneHeader=!0)}),-1===e&&f.reorderList(a.items)});var f={move:function(b,c){if(1===b.length)b[0].order=d,a.saveEdits(b[0]);else if(0===c)b[1].order>2?(b[c].order=Math.floor(b[1].order/2),a.saveEdits(b[c])):(b[c].order=0,f.reorderList(b));else if(c===b.length-1)b[b.length-2].order+d<e?(b[c].order=b[b.length-2].order+d,a.saveEdits(b[c])):(b[c].order=b[b.length-2].order+1,f.reorderList(b));else{var g=b[c+1].order-b[c-1].order;if(g>3){var h=b[c-1].order+Math.floor(g/2);b[c].order=h,a.saveEdits(b[c])}else b[c].order=b[c-1].order+1,f.reorderList(b)}return b},reorderList:function(b){var c=d;console.log("reorderList"),(b.length-1)*d>e&&(c=Math.floor(e/b.length));var f=c;return angular.forEach(b,function(b){b.order=f,a.saveEdits(b),f+=c}),b},outputList:function(a){var b="";angular.forEach(a,function(a){b=b+", "+a.title+": "+a.order}),console.log(b)}};a.indexOfFirstDone=function(){if(void 0===a.items)return void console.log("indexOfFirstDone() called while $scope.items is undefined");for(var b=0;b<a.items.length;b++)if(a.items[b].done)return b;return a.items.length},a.lengthOfUndone=function(){var b=a.indexOfFirstDone();return 1==a.hasDoneHeader?b-1:b},a.sortableOptions={beforeStop:function(b,c){a.dest=c.item.index()},stop:function(){f.move(a.items,a.dest)},cursor:"move",cancel:".unsortable",items:"li:not(.unsortable)"},a.addItem=function(){var b={title:a.newItem.trim(),parent:a.list.id,done:!1,archive:!1};if(b.title){var d=new c.server;d.title=b.title,d.parent=b.parent,d.done=b.done,d.archive=b.archive,c.server.save(d,function(b){a.items.unshift(b),a.newItem="",f.move(a.items,0)})}},a.removeItem=function(b){c.server.archive({item_id:b.id},function(){a.items.splice(a.items.indexOf(b),1)})},a.toggle=function(b){c.server.get({item_id:b.id},function(c){console.log(b);var d;c.done=b.done,c.done=!c.done,c.duedate=new Date(b.duedate),a.items.splice(a.items.indexOf(b),1),d=1==c.done?a.indexOfFirstDone():a.lengthOfUndone(),void 0===d&&(d=a.items.length),a.items.splice(d,0,c),f.move(a.items,d)})},a.editItem=function(b){null===b?a.editedItem=null:(a.editedItem=b,a.originalItem=angular.extend({},b))},a.saveEdits=function(b){c.server.get({item_id:b.id},function(c){c.title=b.title,c.type=b.type,c.order=b.order,c.done=b.done,c.notes=b.notes,c.duedate=b.duedate,c.$update({item_id:b.id}),a.editedItem=null,console.log("saved item: "),console.log(b)})},a.revertEdits=function(b){b=a.originalItem,a.editedItem=null}}]),angular.module("webClientApp").controller("ItemCtrl",["$scope","$routeParams","Item","Solution",function(a,b,c,d){c.server.get({item_id:b.id},function(b){a.item=b,c.server.get({item_id:a.item.parent},function(b){a.item.parentTitle=b.title})}),c.server.solutions({item_id:b.id},function(c){a.solutions=c.items,angular.forEach(a.solutions,function(a){d.server.view({id:a.id,item_id:b.id},function(){})})})}]),angular.module("webClientApp").controller("IndexCtrl",["$scope",function(a){a.username="joe"}]),angular.module("webClientApp").controller("ItemExpertCtrl",["$scope","$routeParams","Item","Solution","User",function(a,b,c,d,e){a.solutions=[],a.allsolutions=[],a.item=null,a.user=null,c.server.get({item_id:b.id},function(b){a.item=b,c.server.get({item_id:a.item.parent},function(b){a.item.parentTitle=b.title}),e.server.get({userId:a.item.user_id},function(b){a.user=b})}),c.server.solutions({item_id:b.id},function(b){b.items?(a.solutions=b.items,angular.forEach(a.solutions,function(b){a.getState(b)})):a.solutions=[]}),d.server.query(function(b){a.allsolutions=b}),a.getState=function(a){d.server.state({id:a.id,item_id:b.id},function(b){a.item_state=b,a.item_state.current=a.item_state.like>0?"Liked":a.item_state.like<0?"Disliked":a.item_state.views>0?"Viewed":"Unseen"},function(b){404==b.status&&(a.item_state={},a.item_state.current="Unseen",a.item_state.like=0,a.item_state.clicks=0,a.item_state.views=0)})},a.toggleMap=function(b){var c=a.checkLink(b);-1===c?a.map(b):a.unmap(b,c)},a.checkLink=function(b){if(null===b)return-1;if(a.solutions.length<1)return-1;for(var c=0;c<a.solutions.length;c++)if(a.solutions[c].id===b.id)return c;return-1},a.map=function(d){c.server.mapSolution({solution_id:d.id,item_id:b.id},function(){a.solutions.unshift(d)})},a.unmap=function(d,e){c.server.unmapSolution({solution_id:d.id,item_id:b.id},function(){a.solutions.splice(e,1)})}}]),angular.module("webClientApp").controller("EditSolutionCtrl",["$scope","$routeParams","Solution",function(a,b,c){var d=function(a){return a?a.trim():""};"edit"!=a.mode&&(a.solution={}),a.imageOptions=[],a.currentImageIndex=null,a.triedGetImages=!1,a.btnText||(a.btnText="Create tip"),a.createSolution=function(){if("edit"!=a.mode){var b=new c.server({title:d(a.solution.title),source:d(a.solution.source),price:d(a.solution.price),phone_number:d(a.solution.phone_number),open_hours:d(a.solution.open_hours),link:d(a.solution.link),tags:d(a.solution.tags),expire_date:a.solution.expire_date,img_link:d(a.solution.img_link),description:d(a.solution.description),address:d(a.solution.address),notes:d(a.solution.notes)});c.server.save(b,function(b){console.log("created solution: "),console.log(b),a.mapItem?a.map(b,a.mapItem):a.solutions&&a.solutions.push(b),$("#newSolution").collapse("hide"),a.solution=angular.copy({})})}else console.log("createSolution called when in Edit mode")},a.saveEdits=function(){"edit"==a.mode&&c.server.get({id:a.solution.id},function(b){b.tags=a.solution.tags,b.link=a.solution.link,b.img_link=a.solution.img_link,b.expire_date=a.solution.expire_date,b.notes=a.solution.notes,b.title=a.solution.title,b.source=a.solution.source,b.price=a.solution.price,b.phone_number=a.solution.phone_number,b.open_hours=a.solution.open_hours,b.address=a.solution.address,b.description=a.solution.description,b.$update({id:a.solution.id},function(a){console.log("solution saved: "),console.log(a)})})},a.map=function(b,d){c.server.mapItem({id:b.id,item_id:d.id},function(){c.server.get({id:b.id},function(b){a.mappedSolutions&&a.mappedSolutions.push(b),a.solutions&&a.solutions.push(b)})})},a.fillPreview=function(b){c.opengraph.get({url:b},function(b){console.log(b),b.hybridGraph&&(b.hybridGraph.title&&"edit"!=a.mode&&(a.solution.title=b.hybridGraph.title),a.imageOptions=[],a.triedGetImages=!0,b.hybridGraph.image&&("edit"==a.mode&&""!=a.solution.img_link&&a.imageOptions.push(a.solution.img_link),a.imageOptions.push(b.hybridGraph.image),a.currentImageIndex=0,a.solution.img_link=a.imageOptions[0]),b.htmlInferred&&(a.imageOptions.length<1&&"edit"==a.mode&&""!=a.solution.img_link&&a.imageOptions.push(a.solution.img_link),a.imageOptions=a.imageOptions.concat(b.htmlInferred.images),a.imageOptions.length>0&&(a.currentImageIndex=0,a.solution.img_link=a.imageOptions[0])))}),"edit"!=a.mode&&console.log("TODO: populate the expert name/bio for known urls here.")},a.cycleImage=function(b){null!=a.currentImageIndex&&("next"==b?a.currentImageIndex<a.imageOptions.length-1?(a.currentImageIndex++,a.solution.img_link=a.imageOptions[a.currentImageIndex]):(a.currentImageIndex=0,a.solution.img_link=a.imageOptions[0]):"prev"==b?a.currentImageIndex>0?(a.currentImageIndex--,a.solution.img_link=a.imageOptions[a.currentImageIndex]):(a.currentImageIndex=a.imageOptions.length-1,a.solution.img_link=a.imageOptions[a.currentImageIndex]):b>=0&&b<a.imageOptions.length&&(a.currentImageIndex=b,a.solution.img_link=a.imageOptions[b]),a.saveEdits())}}]),angular.module("webClientApp").controller("AuthCtrl",["$scope","$route","$facebook","Session",function(a,b,c,d){a.$on("dzr-loginRequired",function(){a.showLogin=!0,$(".modal").modal({backdrop:"static",keyboard:!1})}),a.login=function(){c.login().then(function(b){d.server.login({token:b.authResponse.accessToken},function(b){c.api("/me").then(function(c){d.setupSession(b.sessionId,c.name),a.showLogin=!1,$(".modal").modal("hide"),$(".modal-backdrop").remove(),d.retryAllHttp()},function(c){console.log("Setting up session without name. Facebook /me call failed with error:"),console.log(c),d.setupSession(b.sessionId),a.showLogin=!1,$(".modal").modal("hide"),$(".modal-backdrop").remove(),d.retryAllHttp()})},function(a){console.log("Session login to Doozer server failed with error:"),console.log(a)})},function(a){console.log("Facebook login returned with error:"),console.log(a)})},a.logout=function(){c.logout().then(function(){d.server.logout(function(){d.cleanupSession(),b.reload()},function(a){console.log("Session logout to Doozer server failed with error:"),console.log(a)})},function(a){console.log("Facebook logout failed with error:"),console.log(a)})}}]),angular.module("webClientApp").factory("Session",["$rootScope","$resource","$cookies","$http","$q","doozerURL","Item",function(a,b,c,d,e,f,g){var h=null,i=function(a,b){a.headers.sessionId=d.defaults.headers.common.sessionId,d(a).then(function(a){b.resolve(a)},function(a){b.reject(a)})};return{server:b(f+"login/:token",{token:"@token"},{login:{method:"GET"},logout:{url:f+"logout",method:"DELETE",headers:{sessionId:c.get("doozerSession")}}}),checkSession:function(){var a=e.defer();return null==h?c.get("doozerSession")?g.server.lists(function(){h=!0,d.defaults.headers.common.sessionId=c.get("doozerSession"),console.log("checkSession: cookies have session and server call succeeded"),a.resolve(h)},function(b){401==b.status&&(h=!1,c.remove("doozerSession"),c.remove("username"),console.log("checkSession: cookies had session but server 401"),a.resolve(h))}):(h=!1,console.log("checkSession: no session in the cookies!"),a.resolve(h)):(1==h&&(d.defaults.headers.common.sessionId=c.get("doozerSession")),console.log("checkSession: already have a value of: "+h),a.resolve(h)),a.promise},setupSession:function(a,b){h=!0,c.put("doozerSession",a),d.defaults.headers.common.sessionId=a,b&&c.put("username",b)},cleanupSession:function(){h=!1,c.remove("doozerSession"),c.remove("username")},rejectAllHttp:function(b){if(b)for(var c=0;c<a.httpRetryBuffer.length;c++)a.httpRetryBuffer[c].deferred.reject(b);a.httpRetryBuffer=[]},retryAllHttp:function(){for(var b=0;b<a.httpRetryBuffer.length;b++)i(a.httpRetryBuffer[b].config,a.httpRetryBuffer[b].deferred);a.httpRetryBuffer=[]}}}]),angular.module("webClientApp").factory("doozerList",["$resource","$http","$cookies","doozerURL",function(a,b,c,d){var e=a(d+"items/:item_id",{},{query:{headers:{sessionId:c.get("doozerSession")}},get:{headers:{sessionId:c.get("doozerSession")}}}),f={getLists:function(){return e.query({item_id:"index"})},getChildren:function(a){return e.query({item_id:a})},createItem:function(a){return e.save(a)},getItem:function(){},updateItem:function(){},deleteItem:function(){},searchTitles:function(){}};return f}]),angular.module("webClientApp").factory("Item",["$resource","$http","$cookies","doozerURL",function(a,b,c,d){return b.defaults.headers.common.sessionId=c.get("doozerSession"),{server:a(d+"items/:item_id",{item_id:"@item_id",userId:"@userId"},{lists:{url:d+"lists",method:"GET"},listsForUser:{url:d+"listsForUser/:userId",method:"GET"},items:{url:d+"items",method:"GET"},children:{url:d+"items/:item_id/children",method:"GET"},childrenForUser:{url:d+"items/:item_id/childrenForUser/:userId",method:"GET"},archive:{url:d+"items/:item_id/archive",method:"DELETE"},"delete":{method:"DELETE"},get:{},update:{url:d+"items/:item_id",method:"PUT"},mapSolution:{url:d+"items/:item_id/mapSolution",method:"POST"},unmapSolution:{url:d+"items/:item_id/unmapSolution",method:"POST"},solutions:{url:d+"items/:item_id/solutions",method:"GET"}}),getActiveItems:function(a){var b=[];return angular.forEach(a,function(a){(void 0==a.type||""==a.type)&&1!=a.archive&&1!=a.done&&b.push(a)}),b}}}]),angular.module("webClientApp").factory("User",["$resource","$http","$cookies","$q","doozerURL",function(a,b,c,d,e){var f=["10102089177523563","10206549132149223","10100937175140396","4614807584795","10100716370439739","10103069913924734"],g=["888679437823595","10153226353173625","122084741480641","101199530240934","137086416631587","117079795309261","112111952468018","576667532471768","10205412832264814","116507982027936","141847546150698","142353602768062","114492295563780","123927551283708","112243779123425","115426775470435","117065725305424","127213977620124","110215842661130","131274290547238","141793539496778"];return b.defaults.headers.common.sessionId=c.get("doozerSession"),{server:a(e+"users/:userId",{userId:"@userId"},{updateAdmin:{url:e+"updateAdmin",method:"PUT"}}),getBetaIds:function(){var a=d.defer();return a.resolve(f),a.promise},getTestIds:function(){var a=d.defer();return a.resolve(g),a.promise},checkBetaUser:function(a){for(var b=0;b<f.length;b++)if(a==f[b])return!0;return!1},checkTestUser:function(a){for(var b=0;b<g.length;b++)if(a==g[b])return!0;return!1}}}]),angular.module("webClientApp").factory("Search",["$resource","$http","$cookies","doozerURL",function(a,b,c,d){return b.defaults.headers.common.sessionId=c.get("doozerSession"),a(d+"items/:searchTerm/search",{searchTerm:"@searchTerm"},{query:{method:"GET"}})}]),angular.module("webClientApp").factory("Solution",["$resource","$http","$cookies","$q","doozerURL",function(a,b,c,d,e){return b.defaults.headers.common.sessionId=c.get("doozerSession"),{server:a(e+"solutions/:id",{id:"@id",item_id:"@item_id"},{query:{isArray:!0},"delete":{method:"DELETE"},get:{},update:{method:"PUT"},mapItem:{url:e+"solutions/:id/mapItem",method:"POST"},unmapItem:{url:e+"solutions/:id/unmapItem/:item_id",method:"DELETE"},items:{url:e+"solutions/:id/items",method:"GET"},like:{url:e+"solutions/:id/like/:item_id",method:"POST"},dislike:{url:e+"solutions/:id/dislike/:item_id",method:"POST"},view:{url:e+"solutions/:id/view/:item_id",method:"POST"},state:{url:e+"solutions/:id/state/:item_id",method:"GET"},performance:{url:e+"solutions/:id/performance",method:"GET"},for_user:{url:e+"solutions/for_user/:last_sync",method:"GET"}}),setupState:function(a,b){var c={},e=this,f=d.defer();return e.server.state({id:a,item_id:b},function(a){c=a,c.current=c.like>0?"Liked":c.like<0?"Disliked":c.views>0?"Viewed":"Unseen",f.resolve(c)},function(a){404==a.status&&(c.current="Unseen",c.like=0,c.clicks=0,c.views=0),f.resolve(c)}),f.promise},opengraph:a("http://opengraph.io/api/1.0/site/:url",{url:"@url"},{get:{headers:{sessionId:void 0}}})}}]),angular.module("webClientApp").directive("itemEscape",function(){var a=27;return function(b,c,d){c.bind("keydown",function(c){c.keyCode===a&&b.$apply(d.itemEscape)})}}),angular.module("webClientApp").directive("itemFocus",["$timeout",function(a){return function(b,c,d){b.$watch(d.itemFocus,function(b){b&&a(function(){c[0].focus()},0,!1)})}}]),angular.module("ui.sortable",[]).value("uiSortableConfig",{}).directive("uiSortable",["uiSortableConfig","$timeout","$log",function(a,b,c){return{require:"?ngModel",scope:{ngModel:"=",uiSortable:"="},link:function(d,e,f,g){function h(a,b){return b&&"function"==typeof b?function(){a.apply(this,arguments),b.apply(this,arguments)}:a}function i(a){var b=a.data("ui-sortable");return b&&"object"==typeof b&&"ui-sortable"===b.widgetFullName?b:null}function j(a,b){var c=a.sortable("option","helper");return"clone"===c||"function"==typeof c&&b.item.sortable.isCustomHelperUsed()}function k(a){return/left|right/.test(a.css("float"))||/inline|table-cell/.test(a.css("display"))}function l(a,b){for(var c=null,d=0;d<a.length;d++){var e=a[d];if(e.element[0]===b[0]){c=e.scope;break}}return c}function m(a,b){b.item.sortable._destroy()}var n,o={},p={"ui-floating":void 0},q={receive:null,remove:null,start:null,stop:null,update:null},r={helper:null};return angular.extend(o,p,a,d.uiSortable),angular.element.fn&&angular.element.fn.jquery?(g?(d.$watch("ngModel.length",function(){b(function(){i(e)&&e.sortable("refresh")},0,!1)}),q.start=function(a,b){if("auto"===o["ui-floating"]){var c=b.item.siblings(),d=i(angular.element(a.target));d.floating=k(c)}b.item.sortable={model:g.$modelValue[b.item.index()],index:b.item.index(),source:b.item.parent(),sourceModel:g.$modelValue,cancel:function(){b.item.sortable._isCanceled=!0},isCanceled:function(){return b.item.sortable._isCanceled},isCustomHelperUsed:function(){return!!b.item.sortable._isCustomHelperUsed},_isCanceled:!1,_isCustomHelperUsed:b.item.sortable._isCustomHelperUsed,_destroy:function(){angular.forEach(b.item.sortable,function(a,c){b.item.sortable[c]=void 0})}}},q.activate=function(a,b){n=e.contents();var c=e.sortable("option","placeholder");if(c&&c.element&&"function"==typeof c.element){var f=c.element();f=angular.element(f);var g=e.find('[class="'+f.attr("class")+'"]:not([ng-repeat], [data-ng-repeat])');n=n.not(g)}var h=b.item.sortable._connectedSortables||[];h.push({element:e,scope:d}),b.item.sortable._connectedSortables=h},q.update=function(a,b){if(!b.item.sortable.received){b.item.sortable.dropindex=b.item.index();var c=b.item.parent();b.item.sortable.droptarget=c;var f=l(b.item.sortable._connectedSortables,c);b.item.sortable.droptargetModel=f.ngModel,e.sortable("cancel")}j(e,b)&&!b.item.sortable.received&&"parent"===e.sortable("option","appendTo")&&(n=n.not(n.last())),n.appendTo(e),b.item.sortable.received&&(n=null),b.item.sortable.received&&!b.item.sortable.isCanceled()&&d.$apply(function(){g.$modelValue.splice(b.item.sortable.dropindex,0,b.item.sortable.moved)})},q.stop=function(a,b){!b.item.sortable.received&&"dropindex"in b.item.sortable&&!b.item.sortable.isCanceled()?d.$apply(function(){g.$modelValue.splice(b.item.sortable.dropindex,0,g.$modelValue.splice(b.item.sortable.index,1)[0])}):"dropindex"in b.item.sortable&&!b.item.sortable.isCanceled()||j(e,b)||n.appendTo(e),n=null},q.receive=function(a,b){b.item.sortable.received=!0},q.remove=function(a,b){"dropindex"in b.item.sortable||(e.sortable("cancel"),b.item.sortable.cancel()),b.item.sortable.isCanceled()||d.$apply(function(){b.item.sortable.moved=g.$modelValue.splice(b.item.sortable.index,1)[0]})},r.helper=function(a){return a&&"function"==typeof a?function(b,c){var d=a.apply(this,arguments);return c.sortable._isCustomHelperUsed=c!==d,d}:a},d.$watch("uiSortable",function(a){var b=i(e);b&&angular.forEach(a,function(a,c){return c in p?("ui-floating"!==c||a!==!1&&a!==!0||(b.floating=a),void(o[c]=a)):(q[c]?("stop"===c&&(a=h(a,function(){d.$apply()}),a=h(a,m)),a=h(q[c],a)):r[c]&&(a=r[c](a)),o[c]=a,void e.sortable("option",c,a))})},!0),angular.forEach(q,function(a,b){o[b]=h(a,o[b]),"stop"===b&&(o[b]=h(o[b],m))})):c.info("ui.sortable: ngModel not provided!",e),void e.sortable(o)):void c.error("ui.sortable: jQuery should be included before AngularJS!")}}}]),angular.module("webClientApp").directive("dzrSolution",function(){return{restrict:"E",scope:{solution:"=",mode:"@",checkToggle:"&",toggleAction:"&"},templateUrl:"scripts/directives/dzr-solution.html",controller:"SolutionInterCtrl"}}),angular.module("webClientApp").directive("dzrItem",function(){return{restrict:"E",scope:{item:"=",user:"=",mode:"@",checkToggle:"&",toggleAction:"&"},templateUrl:"scripts/directives/dzr-item.html",controller:["$scope","Item",function(a,b){a.saveEdits=function(){b.server.get({item_id:a.item.id},function(b){b.tags=a.item.tags,b.$update({item_id:a.item.id},function(a){console.log("saved item tags: "),console.log(a)})})}}]}}),angular.module("webClientApp").directive("dzrSolutionEdit",function(){return{restrict:"E",scope:{solution:"=",btnText:"@",mode:"@",collapsed:"@",solutions:"=",mapItem:"=",mappedSolutions:"="},templateUrl:"scripts/directives/dzr-solution-edit.html",controller:"EditSolutionCtrl"}}),angular.module("webClientApp").directive("auth",function(){return{restrict:"E",scope:{mode:"@"},templateUrl:"scripts/directives/auth.html",controller:"AuthCtrl"}});